<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Your existing head content -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!--Page Title-->
    <title>Sports Performance Pro - All your records in one place</title>

    <!--Favicon-->
    <link rel="shortcut icon" href="../static/images/favicon.ico" title="Favicon"/>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">

    <script type="text/javascript" charset="utf8" src="https://code.jquery.com/jquery-3.5.1.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

</head>
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
    }

    header {
        background-color: #0077B5;
        color: #fff;
        padding: 20px 0;
        text-align: center;
    }

    nav {
        background-color: #0077B5;
        color: #fff;
        padding: 10px 0;
    }

    nav ul {
        list-style-type: none;
        padding: 0;
        display: flex;
        justify-content: center;
    }

    nav li {
        margin: 0 20px;
    }

    nav a {
        text-decoration: none;
        color: #fff;
        font-weight: bold;
        font-size: 16px;
        transition: color 0.3s ease-in-out;
        padding: 15px 25px;
        border-radius: 15px; /* Add rounded corners to the tab */
    }

    nav a.current {
        color: #fff;
        background-color: #005599;
        font-weight: bold;
        border-radius: 15px; /* Apply rounded corners to the selected tab */
    }

    nav a:hover, nav a:focus {
        color: #005599;
        background-color: #fff;
        border-radius: 15px; /* Apply the same rounded corners on hover/focus */
    }

    .footer {
        position: fixed;
        bottom: 0;
        left: 50%; /* Align the footer to the horizontal center of the viewport */
        transform: translateX(-50%); /* Center the footer horizontally */
        width: 100%;
        background-color: #fff;
        color: #333;
        text-align: center;
        padding: 10px 0;
        z-index: 999;
        box-shadow: 0px -3px 10px rgba(0, 0, 0, 0.2); /* Add shadow effect */
    }

    .footer-content {
        max-width: 1400px;
        margin: 0 auto;
    }

    h1 {
        font-size: 30px;
        margin-top: 20px;
        margin-bottom: 30px;
        color: #0077B5;
    }

    .title {
        font-size: 30px;
        margin-top: 20px;
        margin-bottom: 30px;
        color: #fff; /* White color */
    }

    h2 {
        font-size: 24px;
        margin-bottom: 20px;
        color: #0077B5;
    }

    .container {
        width: 100%; 
        max-width: 1400px;
        margin: 0 auto;
        padding-bottom: 20px;
        padding-left: 20px;
        padding-right: 20px;
        background-color: #fff;
        box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
        border-radius: 5px;
        display: flex;
        flex-direction: column;
        min-height: calc(100vh - 60px); 
        margin-bottom: 60px;
        margin-top: 60px;
    }

    .note-input {
        margin-bottom: 20px;
    }

    textarea {
        width: 100%;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
        margin: 10px 0;
    }

    button {
        background-color: #0077B5;
        color: #fff;
        font-size: 15px;
        border: none;
        padding: 15px 30px;
        border-radius: 5px;
        cursor: pointer;
    }

    button:hover {
        background-color: #00568d;
    }

    .note-history {
        background-color: #f2f2f2;
        border: 1px solid #ccc;
        padding: 30px;
        max-height: 500px; /* Adjust this value as needed */
        overflow-y: auto;

        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        margin-bottom: 15px;
    }

    .note {
        padding: 5px 0;
        margin-bottom: 0px;
        width: 100%; /* Increase the width to make it wider */
        position: relative;
        border-bottom: 1px solid #ccc;
    }

    #athleteNameHeading {
        font-size: 24px;
        color: #0077B5;
        font-weight: bold;
        text-align: center;
    }

    .modal-container {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(23, 15, 15, 0.7  );
        z-index: 2; /* Ensure modal container is on top of other content */
        justify-content: center;
        align-items: center;
    }

    .modal-content {
        background-color: #fff;
        width: 300px;
        padding: 20px;
        text-align: center;
        border-radius: 5px;
        display: flex;
        flex-direction: column; /* Set the flex direction to column to center items vertically */
    }

    .modal-content textarea {
        width: 100%;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
        margin: 10px 0;
    }

    .modal-content input[type="text"] {
        width: 100%;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
        margin: 10px 0;
    }

    .modal-content button {
        background-color: #0077B5;
        color: #fff;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
    }

    .note-date {
        text-align: right;
        position: absolute;
        top: 5px;
        right: 5px;
        font-size: 12px;
        color: #555; /* You can adjust the color as needed */
    }

    #notesContainer {
        max-height: 200%;
    }


    .highlight {
        background-color: rgb(115, 203, 223);
    }

    .note-reply {
        color: #fff; /* Blue color */
        background-color: #0077B5; /* Light blue background */
        padding: 20px;
        border-radius: 5px;
        margin-top: 5px;
        margin-right: 20px;
        margin-left: 20px;
    }
    
    .athlete-details {
        background-color: #0077b5; /* Background color for highlight */
        color: #fff; /* Text color */
        padding: 10px;
        border-radius: 8px;
        margin: 20px 0;
        box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1)
    }

    .athlete-details h2 {
        margin: 0;
        color: #ffd700; /* Gold color for the athlete's name */
        font-size: 1.5em;
    }

    .athlete-details p {
        margin: 5px 0;
        font-size: 1.1em;
    }

    #searchBar {
        padding: 10px;
        width: 300px;
        border: 1px solid #ccc;
        border-radius: 5px;
        outline: none;
        font-size: 16px;
        margin-top: 10px;
    }

    #searchBar:focus {
        border-color: #0077B5; /* Change border color on focus */
        box-shadow: 0 0 5px rgba(0, 119, 181, 0.5); /* Add a subtle box shadow on focus */
    }

    /* Style for athlete details */
    #athleteDetails {
        margin-bottom: 30px;
        background-color: #f2f2f2;
        border: 1px solid #ccc;
        padding: 15px;
        padding-top:25px;
        max-height: 500px; /* Adjust this value as needed */
        overflow-y: auto;

        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        margin-bottom: 15px;
    }

    #selectAnotherAthlete {
        background-color: #00b52d; 
        color: #fff; 
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        margin-top: 10px; 
        width: 200px;
        height: 50px;
        margin-bottom: 20px;
        margin-top: 10px; 
        margin-left: auto; 
        display: block;
        font-size: 16px;
    }

    #selectAnotherAthlete:hover {
        background-color: #0d6605; /* Adjust hover background color as needed */
    }

    /* Custom CSS for the modal */
    .modal-container {
        display: none;
        position: fixed;
        z-index: 1;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgb(0, 0, 0);
        background-color: rgba(0, 0, 0, 0.4);
    }

    .modal-content {
        background-color: #fefefe;
        margin: 10% auto;
        padding: 20px;
        border: 1px solid #888;
        width: 300px;
    }

    .close-button {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
    }

    .close-button:hover,
    .close-button:focus {
        color: black;
        text-decoration: none;
        cursor: pointer;
    }

    .modal-title {
        margin-bottom: 20px;
    }

    /* Added some basic styles for the input and textarea */
    .form-control {
        margin-bottom: 10px;
        width: 100%;
    }
</style>
<body>
    <header>
        <h1 class="title">Sports Performance Pro</h1>
    </header>
    <nav>
        <ul>
            <li><a href="/coachLanding">Home</a></li>
            <li><a href="/workoutSelection">Assign Workouts</a></li>
            <li><a href="/testSelection">Create Tests</a></li>
            <li><a href="/defineExercises">Create Exercises</a></li>
            <li><a href="/notesLanding" class="current">Notes</a></li>
            <li><a href="/coachhNotifications">Notifications</a></li>
            <li><a href="/coachProfile">My Profile</a></li>
        </ul>
    </nav>

    <div class="container">
        <h1 style="text-align: center;">Notes</h1>


        <button id="selectAnotherAthlete">Select Another Athlete</button>
        <div id="athleteDetails"></div>

        <div class="note-input">
            <button id="addNote" type="button" style="float: right; margin-top: 10px;">Add Note</button>
            <input type="text" id="searchBar" placeholder="Search for a note">
        
            <div id="noteModalContainer" class="modal-container">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2 class="modal-title" style="padding-top: 20px;">Add Note</h2>
                        <span id="closeModal" class="close-button" style="display: inline;">&times;</span>
                    </div>
                    <input type="text" id="noteSubject" placeholder="Subject" class="form-control">
                    <textarea id="noteText" placeholder="Add a note..." class="form-control"></textarea>
                    <button id="modalAddNote" class="btn btn-primary" style="margin-top: 15px;">Add</button>
                </div>
            </div>
        </div>

        <div class="note-history" id="noteHistory">
            <!-- Notes will be displayed here -->
            <div id="notesContainer">
                <!-- Notes will be displayed here -->
            </div>
        </div>

        <div id="modalOverlay" class="modal-overlay"></div>
    </div>

    <!-- Your HTML code with confirmation dialog -->
    <div id="confirmReturnDialog" title="Confirm Return" style="display: none;">
        <p>Are you sure you want to return and select another athlete?</p>
    </div>

    <footer>
        <div class="footer">
            2023 Sports Performance Pro
        </div>
    </footer>

    <script>
            function getQueryParams() {
                const queryParams = new URLSearchParams(window.location.search);
                return {
                    coach_id: queryParams.get('coachId'),
                    athlete_id: queryParams.get('athleteId')
                };
            }
        
        document.addEventListener("DOMContentLoaded", function () {
            const addNoteButton = document.getElementById("addNote");
            const noteModalContainer = document.getElementById("noteModalContainer");
            const closeModal = document.getElementById("closeModal");
            const modalAddNote = document.getElementById("modalAddNote");
            const noteText = document.getElementById("noteText");
            const noteSubject = document.getElementById("noteSubject");
            const modalOverlay = document.getElementById("modalOverlay");
            const notesContainer = document.getElementById("notesContainer");
            const queryParams = getQueryParams();

            function fetchAthleteDetails() {
                const apiURL = "/getAthleteById"; // Your API endpoint
                fetch(`${apiURL}?athlete_id=${queryParams.athlete_id}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.error) {
                            athleteNameHeading.textContent = "Athlete details not found.";
                        } else {
                            athleteNameHeading.textContent = `Athlete: ${data.name}, Institute: ${data.institute}, Sports: ${data.sports}, Team: ${data.team}`;
                        }
                    })
                    .catch(error => {
                        console.error('Error fetching athlete details:', error);
                        athleteNameHeading.textContent = "Error fetching athlete details.";
                    });
            }

            function fetchAthleteDetails() {
                const apiURL = "/getAthleteById"; // Your API endpoint
                fetch(`${apiURL}?athlete_id=${queryParams.athlete_id}`)
                    .then(response => response.json())
                    .then(data => {
                        displayAthleteDetails(data);
                    })
                    .catch(error => {
                        console.error('Error fetching athlete details:', error);
                        displayAthleteDetails({ error: true });
                    });
            }

            fetchAthleteDetails();

            function displayAthleteDetails(data) {
                const athleteDetailsContainer = document.getElementById("athleteDetails");

                if (data.error) {
                    athleteDetailsContainer.textContent = "Athlete details not found.";
                } else {
                    // Create an unordered list element
                    const detailsList = document.createElement("ul");

                    // Add list items for each piece of information
                    const nameItem = createListItem("Name", data.name);
                    const instituteItem = createListItem("Institute", data.institute);
                    const sportsItem = createListItem("Sports", data.sports);

                    if (data.team == null) {
                        data.team = "Athlete does not have a team";
                    }
                    const teamItem = createListItem("Team", data.team);

                    // Append list items to the unordered list
                    detailsList.appendChild(nameItem);
                    detailsList.appendChild(instituteItem);
                    detailsList.appendChild(sportsItem);
                    detailsList.appendChild(teamItem);

                    // Replace the content of the athleteDetailsContainer with the unordered list
                    athleteDetailsContainer.innerHTML = '';
                    athleteDetailsContainer.appendChild(detailsList);
                }
            }

            // Helper function to create a list item with a specified label and value
            function createListItem(label, value) {
                const listItem = document.createElement("li");
                listItem.innerHTML = `<strong>${label}:</strong> ${value}`;

                // Apply CSS styles
                listItem.style.fontSize = "16px"; // Adjust the font size as needed
                listItem.style.marginBottom = "8px"; // Add some margin between list items

                return listItem;
            }


            // Function to filter and highlight notes
            function filterNotes() {
                const searchTerm = searchBar.value.trim().toLowerCase();
                const notes = noteHistory.getElementsByClassName("note");

                for (const note of notes) {
                    const noteTextElement = note.querySelector(".note-text");
                    const noteText = noteTextElement.textContent.toLowerCase();

                    if (noteText.includes(searchTerm)) {
                        const highlightedText = noteText.replace(new RegExp(searchTerm, 'gi'), match => `<span class="highlight">${match}</span>`);
                        noteTextElement.innerHTML = highlightedText;
                        note.style.display = "block";
                    } else {
                        noteTextElement.innerHTML = noteText;
                        note.style.display = "none";
                    }
                }
            }

            // Event listener for the search input field
            searchBar.addEventListener("input", filterNotes);

            addNoteButton.addEventListener("click", function () {
                noteModalContainer.style.display = "flex";
                modalOverlay.style.display = "block";
            });

            closeModal.addEventListener("click", function () {
                noteModalContainer.style.display = "none";
                modalOverlay.style.display = "none";
            });



            modalAddNote.addEventListener("click", function () {
                const subject = noteSubject.value.trim();
                const text = noteText.value.trim();
                if (subject !== "" && text !== "") {
                    // Create a new note element
                    const noteElement = document.createElement("div");
                    noteElement.classList.add("note");

                    // Subject line
                    const subjectLine = document.createElement("p");
                    subjectLine.classList.add("note-subject");
                    subjectLine.innerHTML = `<strong>Subject:</strong> ${subject}`;

                    // Note text
                    const noteTextElement = document.createElement("p");
                    noteTextElement.classList.add("note-text");
                    noteTextElement.textContent = text;

                    // Date (inside the note element)
                    const date = document.createElement("p");
                    date.classList.add("note-date");
                    const currentDate = new Date();
                    date.textContent = currentDate.toDateString();

                    // Append subject, date, and note text to the note element
                    noteElement.appendChild(subjectLine);
                    noteElement.appendChild(date);
                    noteElement.appendChild(noteTextElement);

                    // Prepend the new note element to the beginning of the note history
                    notesContainer.prepend(noteElement);

                    // Clear input fields and hide the modal
                    noteSubject.value = "";
                    noteText.value = "";
                    noteModalContainer.style.display = "none";
                    modalOverlay.style.display = "none";

                    // Call the API to post note
                    const apiURL = "/addNote"; // Replace with your API URL
                    const requestData = {
                        coach_id: queryParams.coach_id, // Replace with the appropriate coach ID
                        athlete_id: queryParams.athlete_id, // Replace with the appropriate athlete ID
                        date_created: new Date().toISOString().replace('T', ' ').substring(0, 19),
                        subject: subject,
                        coach_reply: text,
                        athlete_reply: null,
                    };

                    fetch(apiURL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(requestData),
                    })
                    .then(response => response.json())
                    .then(data => {
                        console.log(data); // Log the API response
                    })
                    .catch(error => {
                        console.error(error); // Handle errors
                    });
                }
            });
             // Function to fetch and display notes
            function fetchAndDisplayNotes() {
            const apiURL = "/getNotes"; // Replace with your API URL
            const coachId = queryParams.coach_id; // Replace with the appropriate coach ID
            const athleteId = queryParams.athlete_id; // Replace with the appropriate athlete ID

            // Make a GET request to fetch notes
            fetch(`${apiURL}?coachId=${coachId}&athleteId=${athleteId}`)
                .then(response => response.json())
                .then(data => {
                    const notes = data.notes;

                    console.log(notes); // Log the API response

                    // Clear existing notes
                    notesContainer.innerHTML = "";

                    if (data.message === 'No notes found for the given coach and athlete') {
                        console.log("No notes found."); // Log a message
                        // Display a message when no notes are found
                        const noNotesMessage = document.createElement("p");
                        noNotesMessage.textContent = "No notes added for this athlete.";
                        notesContainer.appendChild(noNotesMessage);
                        
                    } else {
                        // Loop through notes and display them in reverse order
                        for (let i = notes.length - 1; i >= 0; i--) {
                            const noteData = notes[i];
                            const noteElement = document.createElement("div");
                            noteElement.classList.add("note");

                            // Create elements for note details (date, subject, text)
                            const dateElement = document.createElement("p");
                            dateElement.classList.add("note-date");
                            dateElement.textContent = noteData.date_created;

                            const subjectElement = document.createElement("p");
                            subjectElement.classList.add("note-subject");
                            subjectElement.innerHTML = `<strong>Subject:</strong> ${noteData.subject}`;

                            const textElement = document.createElement("p");
                            textElement.classList.add("note-text");
                            textElement.textContent = noteData.coach_reply;

                            // Append elements to the note
                            noteElement.appendChild(dateElement);
                            noteElement.appendChild(subjectElement);
                            noteElement.appendChild(textElement);

                            // Check for athlete reply and display it
                            if (noteData.athlete_reply) {
                                const replyElement = document.createElement("p");
                                replyElement.classList.add("note-reply");
                                replyElement.innerHTML = `<strong><span class="reply-label">Reply:</span></strong> ${noteData.athlete_reply}`;
                                noteElement.appendChild(replyElement);
                            }

                            // Append the note to the beginning of the notes container
                            notesContainer.prepend(noteElement);
                        }
                    }
                })
                .catch(error => {
                    console.error(error); // Handle errors
                });

            }

            // Call the function to fetch and display notes when the page loads
            fetchAndDisplayNotes();


            // Handle the "Select Another athlete" button
            $('#selectAnotherAthlete').click(function (e) {
                e.preventDefault(e);

                $("#confirmReturnDialog").dialog({
                    resizable: false,
                    height: "auto",
                    width: 400,
                    modal: true,
                    buttons: {
                        "Yes": function () {
                            // Redirect to the previous page (workout-selection.html)
                            window.location.href = '/notesLanding';
                            $(this).dialog("close");
                        },
                        "No": function () {
                            $(this).dialog("close");
                        }
                    }
                });
            });
        });
    </script>
</body>
</html>